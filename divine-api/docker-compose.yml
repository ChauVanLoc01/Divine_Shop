version: '3.8'
services:
  api:
    image: nest:v1
    restart: unless-stopped
    volumes:
      - ./dist:/app/dist
      - ./node_modules:/app/node_modules
      - ./prisma:/app/prisma
      - ./.env:/app/.env
    ports:
      - '${STORE_PORT}:${STORE_PORT}'
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - STORE_PORT=${STORE_PORT}
      - TTL_ACCESS_TOKEN=${TTL_ACCESS_TOKEN}
      - TTL_REFRESH_TOKEN=${TTL_REFRESH_TOKEN}
      - SECRET_ACCESS_TOKEN=${SECRET_ACCESS_TOKEN}
      - SECRET_REFRESH_TOKEN=${SECRET_REFRESH_TOKEN}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_SECRET=${GOOGLE_SECRET}
    depends_on:
      - db
  db:
    image: mysql
    restart: unless-stopped
    volumes:
      - ./public/db:/var/lib/mysql
      - ./store_db.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - '3308:3306'
    environment:
      - MYSQL_ROOT_PASSWORD=1234
      - MYSQL_DATABASE=store_db
